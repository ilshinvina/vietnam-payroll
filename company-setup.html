<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì‚¬ í”„ë¡œí•„ ì„¤ì • / Company Profile Setup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .btn-home {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-home:hover {
            background: #667eea;
            color: white;
        }

        .content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .logo-upload {
            margin-bottom: 30px;
        }

        .logo-preview {
            width: 200px;
            height: 200px;
            border: 3px dashed #ddd;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px 0;
            background: #fafafa;
            overflow: hidden;
            position: relative;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .logo-preview .placeholder {
            color: #999;
            text-align: center;
            font-size: 3em;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-block;
        }

        .file-input-label:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .color-picker-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .color-picker-group input[type="color"] {
            width: 80px;
            height: 50px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 40px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #ddd;
            color: #666;
        }

        .btn-secondary:hover {
            background: #ccc;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #666;
            line-height: 1.6;
        }

        .company-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .company-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .company-item:hover {
            border-color: #667eea;
        }

        .company-item.active {
            border-color: #4caf50;
            background: #f1f8f4;
        }

        .company-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .company-logo-small {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .company-logo-small img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .company-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #2196f3;
            color: white;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-select {
            background: #4caf50;
            color: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 30px 20px;
            }

            .content {
                padding: 30px 20px;
            }

            .btn-group {
                flex-direction: column;
            }

            .company-item {
                flex-direction: column;
                gap: 15px;
            }

            .company-actions {
                width: 100%;
                justify-content: stretch;
            }

            .btn-small {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="btn-home">ğŸ  í™ˆìœ¼ë¡œ</a>
            <h1>ğŸ¢ íšŒì‚¬ í”„ë¡œí•„ ì„¤ì •</h1>
            <p>Company Profile Setup / CÃ i Ä‘áº·t há»“ sÆ¡ cÃ´ng ty</p>
        </div>

        <div class="content">
            <div class="info-box">
                <h3>ğŸ“Œ ì•ˆë‚´</h3>
                <p>
                    â€¢ ê° íšŒì‚¬ë³„ë¡œ ë¡œê³ ì™€ ì •ë³´ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                    â€¢ ë¡œê³ ëŠ” ê¸‰ì—¬ëª…ì„¸ì„œ PDFì™€ ëª¨ë“  í˜ì´ì§€ í—¤ë”ì— í‘œì‹œë©ë‹ˆë‹¤.<br>
                    â€¢ ì¼ëŸ¬ìŠ¤íŠ¸ íŒŒì¼(.AI)ì€ ë¨¼ì € PNGë‚˜ JPGë¡œ ë³€í™˜í•´ì„œ ì—…ë¡œë“œí•˜ì„¸ìš”.<br>
                    â€¢ ì—¬ëŸ¬ íšŒì‚¬ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì–¸ì œë“  ì „í™˜ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                </p>
            </div>

            <!-- ê¸°ì¡´ íšŒì‚¬ ëª©ë¡ -->
            <div id="companyListSection" style="display: none;">
                <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“‹ ë“±ë¡ëœ íšŒì‚¬ ëª©ë¡</h2>
                <div class="company-list" id="companyList">
                    <!-- JavaScriptë¡œ ì±„ì›Œì§ -->
                </div>
            </div>

            <!-- íšŒì‚¬ ë“±ë¡/ìˆ˜ì • í¼ -->
            <h2 style="color: #667eea; margin-bottom: 20px;" id="formTitle">â• ìƒˆ íšŒì‚¬ ë“±ë¡</h2>

            <form id="companyForm" onsubmit="saveCompany(event)">
                <input type="hidden" id="companyId" value="">

                <div class="form-group logo-upload">
                    <label>ğŸ–¼ï¸ íšŒì‚¬ ë¡œê³  (Logo / Logo cÃ´ng ty)</label>
                    <div class="logo-preview" id="logoPreview">
                        <div class="placeholder">ğŸ¢</div>
                    </div>

                    <!-- ë¡œì»¬ íŒŒì¼ ê²½ë¡œ ì…ë ¥ (ê¶Œì¥) -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 0.95em; color: #4caf50;">
                            ğŸ“‚ ë¡œì»¬ íŒŒì¼ ê²½ë¡œ (ê¶Œì¥ - ìš©ëŸ‰ ì ˆì•½)
                        </label>
                        <input type="text" id="logoPath" placeholder="ì˜ˆ: assets/lgos/khanh-quynh-logo1.png"
                               style="width: 100%; padding: 10px; border: 2px solid #4caf50; border-radius: 8px; font-size: 0.9em;"
                               onchange="previewLocalLogo(event)">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            ğŸ’¡ ë¡œê³ ë¥¼ assets/lgos/ í´ë”ì— ì €ì¥í•œ ê²½ìš° íŒŒì¼ ê²½ë¡œë§Œ ì…ë ¥í•˜ì„¸ìš” (localStorage ìš©ëŸ‰ ì ˆì•½)
                        </small>
                    </div>

                    <!-- ë˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ -->
                    <div style="text-align: center; margin: 15px 0; color: #999;">
                        â”â”â” ë˜ëŠ” â”â”â”
                    </div>

                    <div class="file-input-wrapper">
                        <input type="file" id="logoInput" accept="image/png,image/jpeg,image/jpg,image/svg+xml" onchange="previewLogo(event)">
                        <label for="logoInput" class="file-input-label">
                            ğŸ“ íŒŒì¼ ì—…ë¡œë“œ (PNG, JPG, SVG)
                        </label>
                    </div>
                    <p style="color: #999; margin-top: 10px; font-size: 0.9em;">
                        âš ï¸ ì—…ë¡œë“œëŠ” localStorageì— ì €ì¥ë˜ì–´ ìš©ëŸ‰ ì œí•œì´ ìˆìŠµë‹ˆë‹¤
                    </p>
                </div>

                <div class="form-group">
                    <label>ğŸ¢ íšŒì‚¬ëª… (Company Name / TÃªn cÃ´ng ty) *</label>
                    <input type="text" id="companyName" placeholder="ì˜ˆ: ì¹¸ì¿ ì¸ ê³µì¥ / KHANH QUYNH Factory" required>
                </div>

                <div class="form-group">
                    <label>ğŸ¢ ë² íŠ¸ë‚¨ íšŒì‚¬ëª… (Vietnamese Name / TÃªn tiáº¿ng Viá»‡t)</label>
                    <input type="text" id="companyNameVN" placeholder="ì˜ˆ: CÃ”NG TY KHANH QUYNH">
                </div>

                <div class="form-group">
                    <label>ğŸ“ ì£¼ì†Œ (Address / Äá»‹a chá»‰)</label>
                    <textarea id="companyAddress" placeholder="ì˜ˆ: Cá»§ Chi, Há»“ ChÃ­ Minh City, Vietnam"></textarea>
                </div>

                <div class="form-group">
                    <label>ğŸ“ ì—°ë½ì²˜ (Contact / LiÃªn há»‡)</label>
                    <input type="text" id="companyContact" placeholder="ì˜ˆ: +84 xxx xxx xxx">
                </div>

                <div class="form-group">
                    <label>ğŸ¨ íšŒì‚¬ ìƒ‰ìƒ (Company Color / MÃ u cÃ´ng ty)</label>
                    <div class="color-picker-group">
                        <input type="color" id="companyColor" value="#667eea">
                        <span>í˜ì´ì§€ í…Œë§ˆ ìƒ‰ìƒìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤</span>
                    </div>
                </div>

                <!-- í†µí™” ë° ìˆ«ì í˜•ì‹ ì„¤ì • -->
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 30px; border: 2px solid #e0e0e0;">
                    <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ’° í†µí™” ë° ìˆ«ì í˜•ì‹ ì„¤ì •</h3>

                    <div class="form-group" style="margin-bottom: 20px;">
                        <label>ğŸ’µ í†µí™” ê¸°í˜¸ (Currency Symbol)</label>
                        <select id="currencyFormat" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;" onchange="updateFormatPreview()">
                            <option value="VND">ğŸ‡»ğŸ‡³ VND - Ä‘ (ë² íŠ¸ë‚¨ ë™)</option>
                            <option value="KRW">ğŸ‡°ğŸ‡· KRW - â‚© (í•œêµ­ ì›)</option>
                            <option value="USD">ğŸ‡ºğŸ‡¸ USD - $ (ë¯¸êµ­ ë‹¬ëŸ¬)</option>
                            <option value="NONE">ì—†ìŒ (ìˆ«ìë§Œ)</option>
                        </select>
                    </div>

                    <div class="form-group" style="margin-bottom: 20px;">
                        <label>ğŸ”¢ ìˆ«ì êµ¬ë¶„ì í˜•ì‹ (Number Format)</label>
                        <select id="numberFormat" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;" onchange="updateFormatPreview()">
                            <option value="comma">ì‰¼í‘œ (,) - ì˜ˆ: 1,234,567</option>
                            <option value="dot">ì  (.) - ì˜ˆ: 1.234.567</option>
                            <option value="space">ê³µë°± ( ) - ì˜ˆ: 1 234 567</option>
                        </select>
                    </div>

                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #4caf50;">
                        <strong style="color: #2e7d32;">ë¯¸ë¦¬ë³´ê¸°:</strong>
                        <span id="formatPreview" style="font-size: 1.3em; font-weight: bold; color: #333; margin-left: 10px;">1,234,567 Ä‘</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>ğŸ“ ë¹„ê³  (Notes / Ghi chÃº)</label>
                    <textarea id="companyNotes" placeholder="ê¸°íƒ€ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        âœ… ì €ì¥í•˜ê³  ì‚¬ìš©í•˜ê¸°
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="cancelEdit()">
                        âŒ ì·¨ì†Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let companies = {};
        let currentCompanyId = null;
        let currentLogoData = null;
        let editingCompanyId = null;

        // ì´ˆê¸°í™”
        function init() {
            loadCompanies();
            displayCompanyList();
        }

        // íšŒì‚¬ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadCompanies() {
            const stored = localStorage.getItem('companyProfiles');
            if (stored) {
                companies = JSON.parse(stored);
            }

            const currentId = localStorage.getItem('currentCompanyId');
            if (currentId) {
                currentCompanyId = currentId;
            }
        }

        // íšŒì‚¬ ëª©ë¡ í‘œì‹œ
        function displayCompanyList() {
            const listSection = document.getElementById('companyListSection');
            const listDiv = document.getElementById('companyList');

            if (Object.keys(companies).length === 0) {
                listSection.style.display = 'none';
                return;
            }

            listSection.style.display = 'block';
            listDiv.innerHTML = '';

            for (const id in companies) {
                const company = companies[id];
                const isActive = id === currentCompanyId;

                const item = document.createElement('div');
                item.className = 'company-item' + (isActive ? ' active' : '');
                item.innerHTML = `
                    <div class="company-info">
                        <div class="company-logo-small">
                            ${company.logo ? `<img src="${company.logo}" alt="${company.name}">` : 'ğŸ¢'}
                        </div>
                        <div>
                            <div style="font-weight: bold; font-size: 1.1em; color: #333;">${company.name}</div>
                            <div style="color: #999; font-size: 0.9em;">${company.address || 'ì£¼ì†Œ ë¯¸ë“±ë¡'}</div>
                            ${isActive ? '<div style="color: #4caf50; font-size: 0.9em; margin-top: 5px;">âœ“ í˜„ì¬ ì‚¬ìš© ì¤‘</div>' : ''}
                        </div>
                    </div>
                    <div class="company-actions">
                        ${!isActive ? `<button class="btn-small btn-select" onclick="selectCompany('${id}')">ì‚¬ìš©í•˜ê¸°</button>` : ''}
                        <button class="btn-small btn-edit" onclick="editCompany('${id}')">ìˆ˜ì •</button>
                        <button class="btn-small btn-delete" onclick="deleteCompany('${id}')">ì‚­ì œ</button>
                    </div>
                `;
                listDiv.appendChild(item);
            }
        }

        // ë¡œì»¬ íŒŒì¼ ê²½ë¡œ ë¯¸ë¦¬ë³´ê¸°
        function previewLocalLogo(event) {
            const path = event.target.value.trim();
            if (!path) return;

            // ë¡œì»¬ ê²½ë¡œë¥¼ currentLogoDataì— ì €ì¥ (Base64ê°€ ì•„ë‹Œ ê²½ë¡œ ë¬¸ìì—´)
            currentLogoData = path;
            const preview = document.getElementById('logoPreview');
            preview.innerHTML = `<img src="${path}" alt="Logo" onerror="this.parentElement.innerHTML='<div class=\\'placeholder\\' style=\\'color:red\\'>âŒ<br>íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>'">`;
        }

        // ë¡œê³  íŒŒì¼ ì—…ë¡œë“œ ë¯¸ë¦¬ë³´ê¸°
        function previewLogo(event) {
            const file = event.target.files[0];
            if (!file) return;

            // íŒŒì¼ í¬ê¸° ì²´í¬ (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('âš ï¸ íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. 5MB ì´í•˜ì˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                currentLogoData = e.target.result;
                const preview = document.getElementById('logoPreview');
                preview.innerHTML = `<img src="${currentLogoData}" alt="Logo">`;

                // ë¡œì»¬ ê²½ë¡œ í•„ë“œ ë¹„ìš°ê¸°
                document.getElementById('logoPath').value = '';
            };
            reader.readAsDataURL(file);
        }

        // íšŒì‚¬ ì €ì¥
        function saveCompany(event) {
            event.preventDefault();

            const companyName = document.getElementById('companyName').value.trim();
            if (!companyName) {
                alert('âš ï¸ íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }

            const id = editingCompanyId || 'company_' + Date.now();

            const companyData = {
                id: id,
                name: companyName,
                nameVN: document.getElementById('companyNameVN').value.trim(),
                address: document.getElementById('companyAddress').value.trim(),
                contact: document.getElementById('companyContact').value.trim(),
                color: document.getElementById('companyColor').value,
                currencyFormat: document.getElementById('currencyFormat').value,
                numberFormat: document.getElementById('numberFormat').value,
                notes: document.getElementById('companyNotes').value.trim(),
                logo: currentLogoData || (companies[id] ? companies[id].logo : null),
                createdAt: companies[id] ? companies[id].createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            companies[id] = companyData;
            localStorage.setItem('companyProfiles', JSON.stringify(companies));

            // ìë™ìœ¼ë¡œ ì´ íšŒì‚¬ë¥¼ í˜„ì¬ íšŒì‚¬ë¡œ ì„¤ì •
            currentCompanyId = id;
            localStorage.setItem('currentCompanyId', id);

            alert(`âœ… ${companyName} í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ì œ ì´ íšŒì‚¬ì˜ ê¸‰ì—¬ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•©ë‹ˆë‹¤.`);

            // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = 'index.html';
        }

        // íšŒì‚¬ ì„ íƒ
        function selectCompany(id) {
            currentCompanyId = id;
            localStorage.setItem('currentCompanyId', id);
            alert(`âœ… ${companies[id].name} (ìœ¼)ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            displayCompanyList();
        }

        // íšŒì‚¬ ìˆ˜ì •
        function editCompany(id) {
            const company = companies[id];
            editingCompanyId = id;

            document.getElementById('formTitle').textContent = 'âœï¸ íšŒì‚¬ ì •ë³´ ìˆ˜ì •';
            document.getElementById('companyId').value = id;
            document.getElementById('companyName').value = company.name;
            document.getElementById('companyNameVN').value = company.nameVN || '';
            document.getElementById('companyAddress').value = company.address || '';
            document.getElementById('companyContact').value = company.contact || '';
            document.getElementById('companyColor').value = company.color || '#667eea';
            document.getElementById('currencyFormat').value = company.currencyFormat || 'VND';
            document.getElementById('numberFormat').value = company.numberFormat || 'comma';
            document.getElementById('companyNotes').value = company.notes || '';
            updateFormatPreview();

            if (company.logo) {
                currentLogoData = company.logo;
                document.getElementById('logoPreview').innerHTML = `<img src="${company.logo}" alt="Logo">`;

                // ë¡œì»¬ ê²½ë¡œì¸ì§€ Base64ì¸ì§€ êµ¬ë¶„
                if (!company.logo.startsWith('data:')) {
                    // ë¡œì»¬ íŒŒì¼ ê²½ë¡œ
                    document.getElementById('logoPath').value = company.logo;
                } else {
                    // Base64 ì—…ë¡œë“œ
                    document.getElementById('logoPath').value = '';
                }
            }

            // í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('companyForm').scrollIntoView({ behavior: 'smooth' });
        }

        // íšŒì‚¬ ì‚­ì œ
        function deleteCompany(id) {
            const company = companies[id];

            if (id === currentCompanyId) {
                alert('âš ï¸ í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ íšŒì‚¬ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!\n\në‹¤ë¥¸ íšŒì‚¬ë¡œ ì „í™˜í•œ í›„ ì‚­ì œí•˜ì„¸ìš”.');
                return;
            }

            if (confirm(`âš ï¸ ${company.name} íšŒì‚¬ í”„ë¡œí•„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\níšŒì‚¬ ì •ë³´ë§Œ ì‚­ì œë˜ë©°, ê¸‰ì—¬ ë°ì´í„°ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.`)) {
                delete companies[id];
                localStorage.setItem('companyProfiles', JSON.stringify(companies));
                displayCompanyList();
                alert('âœ… ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // ìˆ˜ì • ì·¨ì†Œ
        function cancelEdit() {
            editingCompanyId = null;
            currentLogoData = null;
            document.getElementById('formTitle').textContent = 'â• ìƒˆ íšŒì‚¬ ë“±ë¡';
            document.getElementById('companyForm').reset();
            document.getElementById('logoPreview').innerHTML = '<div class="placeholder">ğŸ¢</div>';
            document.getElementById('logoPath').value = '';
            updateFormatPreview();
        }

        // ìˆ«ì í¬ë§· ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updateFormatPreview() {
            const currency = document.getElementById('currencyFormat').value;
            const numberFmt = document.getElementById('numberFormat').value;
            const testNumber = 1234567;

            let formattedNumber;
            if (numberFmt === 'comma') {
                formattedNumber = testNumber.toLocaleString('en-US');
            } else if (numberFmt === 'dot') {
                formattedNumber = testNumber.toLocaleString('de-DE');
            } else {
                formattedNumber = testNumber.toLocaleString('fr-FR');
            }

            let currencySymbol = '';
            let suffix = false;
            if (currency === 'VND') {
                currencySymbol = 'Ä‘';
                suffix = true;
            } else if (currency === 'KRW') {
                currencySymbol = 'â‚©';
                suffix = false;
            } else if (currency === 'USD') {
                currencySymbol = '$';
                suffix = false;
            }

            let preview;
            if (suffix) {
                preview = formattedNumber + ' ' + currencySymbol;
            } else if (currencySymbol) {
                preview = currencySymbol + formattedNumber;
            } else {
                preview = formattedNumber;
            }

            document.getElementById('formatPreview').textContent = preview;
        }

        // ê¸°ë³¸ íšŒì‚¬ í”„ë¡œí•„ ìƒì„±
        function createDefaultCompany() {
            // ì´ë¯¸ íšŒì‚¬ê°€ ìˆìœ¼ë©´ ìƒì„±í•˜ì§€ ì•ŠìŒ
            if (Object.keys(companies).length > 0) {
                return;
            }

            // KHANH QUYNH ê¸°ë³¸ íšŒì‚¬ í”„ë¡œí•„ ìƒì„±
            const defaultId = 'company_khanh_quynh';
            const defaultCompany = {
                id: defaultId,
                name: 'KHANH QUYNH Factory',
                nameVN: 'CÃ”NG TY KHÃNH QUá»²NH',
                address: 'Cá»§ Chi, Há»“ ChÃ­ Minh City, Vietnam',
                contact: '+84 xxx xxx xxx',
                color: '#667eea',
                currencyFormat: 'VND',
                numberFormat: 'comma',
                logo: 'assets/lgos/khanh-quynh-logo1.png', // ë¡œì»¬ íŒŒì¼ ê²½ë¡œ
                notes: 'ê¸°ë³¸ íšŒì‚¬ í”„ë¡œí•„ (ìë™ ìƒì„±)',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            companies[defaultId] = defaultCompany;
            localStorage.setItem('companyProfiles', JSON.stringify(companies));

            // í˜„ì¬ íšŒì‚¬ë¡œ ì„¤ì •
            currentCompanyId = defaultId;
            localStorage.setItem('currentCompanyId', defaultId);

            console.log('âœ… KHANH QUYNH ê¸°ë³¸ íšŒì‚¬ í”„ë¡œí•„ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            init();
            createDefaultCompany();
        };
    </script>
</body>
</html>
