<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√†i ƒë·∫∑t h·ªì s∆° c√¥ng ty / Company Profile Setup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .logo-upload {
            margin-bottom: 30px;
        }

        .logo-preview {
            width: 200px;
            height: 200px;
            border: 3px dashed #ddd;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px 0;
            background: #fafafa;
            overflow: hidden;
            position: relative;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .logo-preview .placeholder {
            color: #999;
            text-align: center;
            font-size: 3em;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-block;
        }

        .file-input-label:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .color-picker-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .color-picker-group input[type="color"] {
            width: 80px;
            height: 50px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 40px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #ddd;
            color: #666;
        }

        .btn-secondary:hover {
            background: #ccc;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #666;
            line-height: 1.6;
        }

        .company-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .company-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .company-item:hover {
            border-color: #667eea;
        }

        .company-item.active {
            border-color: #4caf50;
            background: #f1f8f4;
        }

        .company-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .company-logo-small {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .company-logo-small img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .company-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #2196f3;
            color: white;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-select {
            background: #4caf50;
            color: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 30px 20px;
            }

            .content {
                padding: 30px 20px;
            }

            .btn-group {
                flex-direction: column;
            }

            .company-item {
                flex-direction: column;
                gap: 15px;
            }

            .company-actions {
                width: 100%;
                justify-content: stretch;
            }

            .btn-small {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ C√†i ƒë·∫∑t h·ªì s∆° c√¥ng ty</h1>
            <p>Company Profile Setup / ÌöåÏÇ¨ ÌîÑÎ°úÌïÑ ÏÑ§Ï†ï</p>
        </div>

        <div class="content">
            <div class="info-box">
                <h3>üìå H∆∞·ªõng d·∫´n</h3>
                <p>
                    ‚Ä¢ B·∫°n c√≥ th·ªÉ thi·∫øt l·∫≠p logo v√† th√¥ng tin cho t·ª´ng c√¥ng ty.<br>
                    ‚Ä¢ Logo s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã tr√™n b·∫£ng l∆∞∆°ng PDF v√† t·∫•t c·∫£ c√°c trang.<br>
                    ‚Ä¢ T·ªáp Illustrator (.AI) ph·∫£i ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi sang PNG ho·∫∑c JPG tr∆∞·ªõc khi t·∫£i l√™n.<br>
                    ‚Ä¢ B·∫°n c√≥ th·ªÉ qu·∫£n l√Ω nhi·ªÅu c√¥ng ty v√† chuy·ªÉn ƒë·ªïi b·∫•t c·ª© l√∫c n√†o.
                </p>
            </div>

            <!-- Danh s√°ch c√¥ng ty hi·ªán c√≥ -->
            <div id="companyListSection" style="display: none;">
                <h2 style="color: #667eea; margin-bottom: 20px;">üìã Danh s√°ch c√¥ng ty ƒë√£ ƒëƒÉng k√Ω</h2>
                <div class="company-list" id="companyList">
                    <!-- ƒê∆∞·ª£c ƒëi·ªÅn b·ªüi JavaScript -->
                </div>
            </div>

            <!-- Bi·ªÉu m·∫´u ƒëƒÉng k√Ω/ch·ªânh s·ª≠a c√¥ng ty -->
            <h2 style="color: #667eea; margin-bottom: 20px;" id="formTitle">‚ûï ƒêƒÉng k√Ω c√¥ng ty m·ªõi</h2>

            <form id="companyForm" onsubmit="saveCompany(event)">
                <input type="hidden" id="companyId" value="">

                <div class="form-group logo-upload">
                    <label>üñºÔ∏è Logo c√¥ng ty (Logo / ÌöåÏÇ¨ Î°úÍ≥†)</label>
                    <div class="logo-preview" id="logoPreview">
                        <div class="placeholder">üè¢</div>
                    </div>

                    <!-- ƒê∆∞·ªùng d·∫´n t·ªáp c·ª•c b·ªô (Khuy·∫øn ngh·ªã) -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 0.95em; color: #4caf50;">
                            üìÇ ƒê∆∞·ªùng d·∫´n t·ªáp c·ª•c b·ªô (Khuy·∫øn ngh·ªã - Ti·∫øt ki·ªám dung l∆∞·ª£ng)
                        </label>
                        <input type="text" id="logoPath" placeholder="VD: assets/lgos/khanh-quynh-logo1.png"
                               style="width: 100%; padding: 10px; border: 2px solid #4caf50; border-radius: 8px; font-size: 0.9em;"
                               onchange="previewLocalLogo(event)">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            üí° N·∫øu b·∫°n ƒë√£ l∆∞u logo trong th∆∞ m·ª•c assets/lgos/, ch·ªâ c·∫ßn nh·∫≠p ƒë∆∞·ªùng d·∫´n t·ªáp (Ti·∫øt ki·ªám localStorage)
                        </small>
                    </div>

                    <!-- Ho·∫∑c t·∫£i t·ªáp l√™n -->
                    <div style="text-align: center; margin: 15px 0; color: #999;">
                        ‚îÅ‚îÅ‚îÅ Ho·∫∑c ‚îÅ‚îÅ‚îÅ
                    </div>

                    <div class="file-input-wrapper">
                        <input type="file" id="logoInput" accept="image/png,image/jpeg,image/jpg,image/svg+xml" onchange="previewLogo(event)">
                        <label for="logoInput" class="file-input-label">
                            üìÅ T·∫£i t·ªáp l√™n (PNG, JPG, SVG)
                        </label>
                    </div>
                    <p style="color: #999; margin-top: 10px; font-size: 0.9em;">
                        ‚ö†Ô∏è T·∫£i l√™n s·∫Ω l∆∞u tr·ªØ trong localStorage v√† c√≥ gi·ªõi h·∫°n dung l∆∞·ª£ng
                    </p>
                </div>

                <div class="form-group">
                    <label>üè¢ T√™n c√¥ng ty (Company Name / ÌöåÏÇ¨Î™Ö) *</label>
                    <input type="text" id="companyName" placeholder="VD: Nh√† m√°y KHANH QUYNH / KHANH QUYNH Factory" required>
                </div>

                <div class="form-group">
                    <label>üè¢ T√™n c√¥ng ty ti·∫øng Vi·ªát (Vietnamese Name / Î≤†Ìä∏ÎÇ® ÌöåÏÇ¨Î™Ö)</label>
                    <input type="text" id="companyNameVN" placeholder="VD: C√îNG TY KHANH QUYNH">
                </div>

                <div class="form-group">
                    <label>üìç ƒê·ªãa ch·ªâ (Address / Ï£ºÏÜå)</label>
                    <textarea id="companyAddress" placeholder="VD: C·ªß Chi, H·ªì Ch√≠ Minh City, Vietnam"></textarea>
                </div>

                <div class="form-group">
                    <label>üìû Li√™n h·ªá (Contact / Ïó∞ÎùΩÏ≤ò)</label>
                    <input type="text" id="companyContact" placeholder="VD: +84 xxx xxx xxx">
                </div>

                <div class="form-group">
                    <label>üé® M√†u c√¥ng ty (Company Color / ÌöåÏÇ¨ ÏÉâÏÉÅ)</label>
                    <div class="color-picker-group">
                        <input type="color" id="companyColor" value="#667eea">
                        <span>S·ª≠ d·ª•ng l√†m m√†u ch·ªß ƒë·ªÅ c·ªßa trang</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>üìù Ghi ch√∫ (Notes / ÎπÑÍ≥†)</label>
                    <textarea id="companyNotes" placeholder="Nh·∫≠p th√¥ng tin kh√°c"></textarea>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ L∆∞u v√† s·ª≠ d·ª•ng
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="cancelEdit()">
                        ‚ùå H·ªßy
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let companies = {};
        let currentCompanyId = null;
        let currentLogoData = null;
        let editingCompanyId = null;

        // Kh·ªüi t·∫°o
        function init() {
            loadCompanies();
            displayCompanyList();
        }

        // T·∫£i th√¥ng tin c√¥ng ty
        function loadCompanies() {
            const stored = localStorage.getItem('companyProfiles');
            if (stored) {
                companies = JSON.parse(stored);
            }

            const currentId = localStorage.getItem('currentCompanyId');
            if (currentId) {
                currentCompanyId = currentId;
            }
        }

        // Hi·ªÉn th·ªã danh s√°ch c√¥ng ty
        function displayCompanyList() {
            const listSection = document.getElementById('companyListSection');
            const listDiv = document.getElementById('companyList');

            if (Object.keys(companies).length === 0) {
                listSection.style.display = 'none';
                return;
            }

            listSection.style.display = 'block';
            listDiv.innerHTML = '';

            for (const id in companies) {
                const company = companies[id];
                const isActive = id === currentCompanyId;

                const item = document.createElement('div');
                item.className = 'company-item' + (isActive ? ' active' : '');
                item.innerHTML = `
                    <div class="company-info">
                        <div class="company-logo-small">
                            ${company.logo ? `<img src="${company.logo}" alt="${company.name}">` : 'üè¢'}
                        </div>
                        <div>
                            <div style="font-weight: bold; font-size: 1.1em; color: #333;">${company.name}</div>
                            <div style="color: #999; font-size: 0.9em;">${company.address || 'Ch∆∞a c√≥ ƒë·ªãa ch·ªâ'}</div>
                            ${isActive ? '<div style="color: #4caf50; font-size: 0.9em; margin-top: 5px;">‚úì ƒêang s·ª≠ d·ª•ng</div>' : ''}
                        </div>
                    </div>
                    <div class="company-actions">
                        ${!isActive ? `<button class="btn-small btn-select" onclick="selectCompany('${id}')">S·ª≠ d·ª•ng</button>` : ''}
                        <button class="btn-small btn-edit" onclick="editCompany('${id}')">S·ª≠a</button>
                        <button class="btn-small btn-delete" onclick="deleteCompany('${id}')">X√≥a</button>
                    </div>
                `;
                listDiv.appendChild(item);
            }
        }

        // Xem tr∆∞·ªõc logo t·ª´ ƒë∆∞·ªùng d·∫´n c·ª•c b·ªô
        function previewLocalLogo(event) {
            const path = event.target.value.trim();
            if (!path) return;

            // L∆∞u ƒë∆∞·ªùng d·∫´n c·ª•c b·ªô v√†o currentLogoData (chu·ªói ƒë∆∞·ªùng d·∫´n, kh√¥ng ph·∫£i Base64)
            currentLogoData = path;
            const preview = document.getElementById('logoPreview');
            preview.innerHTML = `<img src="${path}" alt="Logo" onerror="this.parentElement.innerHTML='<div class=\\'placeholder\\' style=\\'color:red\\'>‚ùå<br>Kh√¥ng t√¨m th·∫•y t·ªáp</div>'">`;
        }

        // Xem tr∆∞·ªõc logo t·ª´ t·∫£i l√™n
        function previewLogo(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Ki·ªÉm tra k√≠ch th∆∞·ªõc t·ªáp (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('‚ö†Ô∏è T·ªáp qu√° l·ªõn. Vui l√≤ng ch·ªçn h√¨nh ·∫£nh d∆∞·ªõi 5MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                currentLogoData = e.target.result;
                const preview = document.getElementById('logoPreview');
                preview.innerHTML = `<img src="${currentLogoData}" alt="Logo">`;

                // X√≥a tr∆∞·ªùng ƒë∆∞·ªùng d·∫´n c·ª•c b·ªô
                document.getElementById('logoPath').value = '';
            };
            reader.readAsDataURL(file);
        }

        // L∆∞u c√¥ng ty
        function saveCompany(event) {
            event.preventDefault();

            const companyName = document.getElementById('companyName').value.trim();
            if (!companyName) {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p t√™n c√¥ng ty!');
                return;
            }

            const id = editingCompanyId || 'company_' + Date.now();

            const companyData = {
                id: id,
                name: companyName,
                nameVN: document.getElementById('companyNameVN').value.trim(),
                address: document.getElementById('companyAddress').value.trim(),
                contact: document.getElementById('companyContact').value.trim(),
                color: document.getElementById('companyColor').value,
                notes: document.getElementById('companyNotes').value.trim(),
                logo: currentLogoData || (companies[id] ? companies[id].logo : null),
                createdAt: companies[id] ? companies[id].createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            companies[id] = companyData;
            localStorage.setItem('companyProfiles', JSON.stringify(companies));

            // T·ª± ƒë·ªông ƒë·∫∑t c√¥ng ty n√†y l√†m c√¥ng ty hi·ªán t·∫°i
            currentCompanyId = id;
            localStorage.setItem('currentCompanyId', id);

            alert(`‚úÖ H·ªì s∆° ${companyName} ƒë√£ ƒë∆∞·ª£c l∆∞u!\n\nB√¢y gi·ªù s·ª≠ d·ª•ng h·ªá th·ªëng l∆∞∆°ng c·ªßa c√¥ng ty n√†y.`);

            // Chuy·ªÉn ƒë·∫øn trang ch√≠nh
            window.location.href = 'index_vn.html';
        }

        // Ch·ªçn c√¥ng ty
        function selectCompany(id) {
            currentCompanyId = id;
            localStorage.setItem('currentCompanyId', id);
            alert(`‚úÖ ƒê√£ chuy·ªÉn sang ${companies[id].name}!`);
            displayCompanyList();
        }

        // Ch·ªânh s·ª≠a c√¥ng ty
        function editCompany(id) {
            const company = companies[id];
            editingCompanyId = id;

            document.getElementById('formTitle').textContent = '‚úèÔ∏è Ch·ªânh s·ª≠a th√¥ng tin c√¥ng ty';
            document.getElementById('companyId').value = id;
            document.getElementById('companyName').value = company.name;
            document.getElementById('companyNameVN').value = company.nameVN || '';
            document.getElementById('companyAddress').value = company.address || '';
            document.getElementById('companyContact').value = company.contact || '';
            document.getElementById('companyColor').value = company.color || '#667eea';
            document.getElementById('companyNotes').value = company.notes || '';

            if (company.logo) {
                currentLogoData = company.logo;
                document.getElementById('logoPreview').innerHTML = `<img src="${company.logo}" alt="Logo">`;

                // Ph√¢n bi·ªát ƒë∆∞·ªùng d·∫´n c·ª•c b·ªô v√† Base64
                if (!company.logo.startsWith('data:')) {
                    // ƒê∆∞·ªùng d·∫´n t·ªáp c·ª•c b·ªô
                    document.getElementById('logoPath').value = company.logo;
                } else {
                    // T·∫£i l√™n Base64
                    document.getElementById('logoPath').value = '';
                }
            }

            // Cu·ªôn ƒë·∫øn bi·ªÉu m·∫´u
            document.getElementById('companyForm').scrollIntoView({ behavior: 'smooth' });
        }

        // X√≥a c√¥ng ty
        function deleteCompany(id) {
            const company = companies[id];

            if (id === currentCompanyId) {
                alert('‚ö†Ô∏è Kh√¥ng th·ªÉ x√≥a c√¥ng ty ƒëang s·ª≠ d·ª•ng!\n\nVui l√≤ng chuy·ªÉn sang c√¥ng ty kh√°c tr∆∞·ªõc khi x√≥a.');
                return;
            }

            if (confirm(`‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªì s∆° c√¥ng ty ${company.name}?\n\nCh·ªâ th√¥ng tin c√¥ng ty s·∫Ω b·ªã x√≥a, d·ªØ li·ªáu l∆∞∆°ng s·∫Ω ƒë∆∞·ª£c gi·ªØ l·∫°i.`)) {
                delete companies[id];
                localStorage.setItem('companyProfiles', JSON.stringify(companies));
                displayCompanyList();
                alert('‚úÖ ƒê√£ x√≥a!');
            }
        }

        // H·ªßy ch·ªânh s·ª≠a
        function cancelEdit() {
            editingCompanyId = null;
            currentLogoData = null;
            document.getElementById('formTitle').textContent = '‚ûï ƒêƒÉng k√Ω c√¥ng ty m·ªõi';
            document.getElementById('companyForm').reset();
            document.getElementById('logoPreview').innerHTML = '<div class="placeholder">üè¢</div>';
            document.getElementById('logoPath').value = '';
        }

        // T·∫°o h·ªì s∆° c√¥ng ty m·∫∑c ƒë·ªãnh
        function createDefaultCompany() {
            // Kh√¥ng t·∫°o n·∫øu ƒë√£ c√≥ c√¥ng ty
            if (Object.keys(companies).length > 0) {
                return;
            }

            // T·∫°o h·ªì s∆° m·∫∑c ƒë·ªãnh KHANH QUYNH
            const defaultId = 'company_khanh_quynh';
            const defaultCompany = {
                id: defaultId,
                name: 'KHANH QUYNH Factory',
                nameVN: 'C√îNG TY KH√ÅNH QU·ª≤NH',
                address: 'C·ªß Chi, H·ªì Ch√≠ Minh City, Vietnam',
                contact: '+84 xxx xxx xxx',
                color: '#667eea',
                logo: 'assets/lgos/khanh-quynh-logo1.png', // ƒê∆∞·ªùng d·∫´n t·ªáp c·ª•c b·ªô
                notes: 'H·ªì s∆° c√¥ng ty m·∫∑c ƒë·ªãnh (T·ª± ƒë·ªông t·∫°o)',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            companies[defaultId] = defaultCompany;
            localStorage.setItem('companyProfiles', JSON.stringify(companies));

            // ƒê·∫∑t l√†m c√¥ng ty hi·ªán t·∫°i
            currentCompanyId = defaultId;
            localStorage.setItem('currentCompanyId', defaultId);

            console.log('‚úÖ ƒê√£ t·∫°o h·ªì s∆° c√¥ng ty m·∫∑c ƒë·ªãnh KHANH QUYNH.');
        }

        // Kh·ªüi t·∫°o khi t·∫£i trang
        window.onload = function() {
            init();
            createDefaultCompany();
        };
    </script>
</body>
</html>
