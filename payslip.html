<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ê¸‰ì—¬ëª…ì„¸ì„œ</title>
    <style>
        @page {
            size: A4;
            margin: 10mm;
        }
    </style>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .payslip-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 10px;
            page-break-inside: avoid;
            break-inside: avoid;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .company-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: #667eea;
        }

        .company-logo img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 50%;
        }

        .company-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .document-title {
            font-size: 1.8em;
            font-weight: bold;
            margin-top: 10px;
        }

        .period {
            font-size: 1.1em;
            margin-top: 5px;
            opacity: 0.9;
        }

        .section {
            padding: 25px 30px;
            page-break-inside: avoid;
            break-inside: avoid;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px dashed #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-weight: 500;
        }

        .info-value {
            font-weight: bold;
            color: #333;
            text-align: right;
        }

        .sub-item {
            padding-left: 20px;
            font-size: 0.95em;
            color: #888;
        }

        .sub-item .info-label {
            color: #888;
        }

        .total-section {
            background: #f9f9f9;
            padding: 30px;
            text-align: center;
        }

        .net-salary-label {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 10px;
        }

        .net-salary-amount {
            font-size: 2.5em;
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 5px;
        }

        .net-salary-text {
            font-size: 1.1em;
            color: #888;
        }

        .footer {
            padding: 20px;
            text-align: center;
            color: #888;
            font-size: 0.9em;
            background: #fafafa;
        }

        .button-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .action-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
        }

        .action-button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-html {
            background: #4caf50;
        }

        .btn-html:hover {
            background: #45a049;
        }

        /* PDF/ì¸ì‡„ ìµœì í™” */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }

            body {
                padding: 0 !important;
                margin: 0 !important;
                background: white !important;
            }

            .payslip-container {
                box-shadow: none !important;
                border-radius: 0 !important;
                max-width: 100% !important;
                width: 100% !important;
                margin: 0 !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            .button-container {
                display: none !important;
            }

            .header {
                page-break-after: avoid !important;
                break-after: avoid !important;
            }

            .section {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            .total-section {
                page-break-before: avoid !important;
                break-before: avoid !important;
            }

            .footer {
                page-break-before: avoid !important;
                break-before: avoid !important;
            }
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px;
            }

            .company-name {
                font-size: 1.2em;
            }

            .document-title {
                font-size: 1.5em;
            }

            .section {
                padding: 20px 15px;
            }

            .net-salary-amount {
                font-size: 2em;
            }

            .button-container {
                bottom: 15px;
                right: 15px;
                flex-direction: column;
                gap: 10px;
            }

            .action-button {
                padding: 12px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="payslip-container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="company-logo" id="companyLogo">ğŸ¢</div>
            <div class="company-name" id="companyName">íšŒì‚¬ëª…</div>
            <div class="document-title">ê¸‰ì—¬ëª…ì„¸ì„œ</div>
            <div class="period" id="period">2025ë…„ 4ì›”</div>
        </div>

        <!-- ì§ì› ì •ë³´ -->
        <div class="section">
            <div class="section-title">ğŸ‘¤ ì§ì› ì •ë³´</div>
            <div class="info-row">
                <span class="info-label">ì„±ëª…</span>
                <span class="info-value" id="empName">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ê¸°ë³¸ê¸‰</span>
                <span class="info-value" id="empBasicSalary">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ë¶€ì–‘ê°€ì¡±</span>
                <span class="info-value" id="empDependents">-</span>
            </div>
        </div>

        <!-- ê·¼ë¬´ í†µê³„ -->
        <div class="section">
            <div class="section-title">ğŸ“Š ê·¼ë¬´ í†µê³„</div>
            <div class="info-row">
                <span class="info-label">ì´ ì¼ìˆ˜</span>
                <span class="info-value" id="statTotalDays">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì‹¤ ê·¼ë¬´ì¼</span>
                <span class="info-value" id="statWorkDays">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì •ê·œ ê·¼ë¬´ì‹œê°„</span>
                <span class="info-value" id="statNormalHours">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì•¼ê·¼ì‹œê°„ (150%)</span>
                <span class="info-value" id="statOvertime">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì•¼ê°„ì‹œê°„ (130%)</span>
                <span class="info-value" id="statNight">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì¼ìš”ì¼ íŠ¹ê·¼ (200%)</span>
                <span class="info-value" id="statSunday">-</span>
            </div>
        </div>

        <!-- ê¸‰ì—¬ ìƒì„¸ -->
        <div class="section">
            <div class="section-title">ğŸ’µ ê¸‰ì—¬ ìƒì„¸</div>
            <div class="info-row">
                <span class="info-label">ì •ê·œ ê·¼ë¬´ ê¸‰ì—¬</span>
                <span class="info-value" id="payNormal">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì•¼ê·¼ ìˆ˜ë‹¹ (150%)</span>
                <span class="info-value" id="payOvertime">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì•¼ê°„ ìˆ˜ë‹¹ (130%)</span>
                <span class="info-value" id="payNight">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì¼ìš”ì¼ ìˆ˜ë‹¹ (200%)</span>
                <span class="info-value" id="paySunday">-</span>
            </div>
            <div class="info-row" style="margin-top: 10px; padding-top: 15px;">
                <span class="info-label" style="font-weight: bold;">ğŸ’µ ì´ ê¸‰ì—¬ ê¸°ë³¸ì•¡</span>
                <span class="info-value" style="color: #2196f3; font-weight: bold; font-size: 1.1em;" id="totalBasicPay">-</span>
            </div>
        </div>

        <!-- ìˆ˜ë‹¹ -->
        <div class="section">
            <div class="section-title">ğŸ ìˆ˜ë‹¹</div>
            <div class="info-row">
                <span class="info-label">ğŸš ì´ ì‹ëŒ€ (<span id="totalMealCount">0</span>ì‹)</span>
                <span class="info-value" id="allowanceMeal">-</span>
            </div>
            <div class="info-row sub-item" id="mealWeekdayLunchRow">
                <span class="info-label">â”” í‰ì¼ ì ì‹¬</span>
                <span class="info-value" id="mealWeekdayLunch">-</span>
            </div>
            <div class="info-row sub-item" id="mealWeekdayDinnerRow">
                <span class="info-label">â”” í‰ì¼ ì €ë… (ì•¼ê·¼)</span>
                <span class="info-value" id="mealWeekdayDinner">-</span>
            </div>
            <div class="info-row sub-item" id="mealSundayLunchRow">
                <span class="info-label">â”” ì¼ìš”ì¼ ì ì‹¬</span>
                <span class="info-value" id="mealSundayLunch">-</span>
            </div>
            <div class="info-row sub-item" id="mealSundayDinnerRow">
                <span class="info-label">â”” ì¼ìš”ì¼ ì €ë…</span>
                <span class="info-value" id="mealSundayDinner">-</span>
            </div>
            <div class="info-row sub-item" id="mealAnnualLeaveLunchRow">
                <span class="info-label">â”” ì—°ì°¨ ì ì‹¬</span>
                <span class="info-value" id="mealAnnualLeaveLunch">-</span>
            </div>
            <div class="info-row sub-item" id="mealExcusedAbsentLunchRow">
                <span class="info-label">â”” ì‚¬ìœ ê²°ê·¼ ì ì‹¬</span>
                <span class="info-value" id="mealExcusedAbsentLunch">-</span>
            </div>
            <!-- ë™ì  ìˆ˜ë‹¹ ì»¨í…Œì´ë„ˆ -->
            <div id="dynamicAllowancesContainer"></div>
            <!-- íŠ¹ìˆ˜ìˆ˜ë‹¹ -->
            <div class="info-row" id="specialAllowanceRow" style="display: none; border-top: 2px solid #9c27b0; margin-top: 10px; padding-top: 10px;">
                <span class="info-label" style="color: #9c27b0; font-weight: bold;">ğŸ’ íŠ¹ìˆ˜ìˆ˜ë‹¹ (Phá»¥ cáº¥p Ä‘áº·c biá»‡t)</span>
                <span class="info-value" style="color: #9c27b0; font-weight: bold;" id="specialAllowanceValue">-</span>
            </div>
            <div class="info-row" style="margin-top: 10px; padding-top: 15px;">
                <span class="info-label" style="font-weight: bold;">ğŸ ì´ ìˆ˜ë‹¹</span>
                <span class="info-value" style="color: #4caf50; font-weight: bold; font-size: 1.1em;" id="totalAllowances">-</span>
            </div>
        </div>

        <!-- ê³µì œ -->
        <div class="section">
            <div class="section-title">â– ê³µì œ</div>
            <div class="info-row">
                <span class="info-label">BHXH (ì‚¬íšŒë³´í—˜)</span>
                <span class="info-value" id="deductSocial">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">BHYT (ê±´ê°•ë³´í—˜)</span>
                <span class="info-value" id="deductHealth">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">BHTN (ì‹¤ì—…ë³´í—˜)</span>
                <span class="info-value" id="deductUnemploy">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ê°œì¸ì†Œë“ì„¸</span>
                <span class="info-value" id="deductTax">-</span>
            </div>
            <!-- ì„ ê¸ˆ -->
            <div class="info-row" id="advancePaymentRow" style="display: none; border-top: 2px solid #ff9800; margin-top: 10px; padding-top: 10px;">
                <span class="info-label" style="color: #ff9800; font-weight: bold;">ğŸ’° ì„ ê¸ˆ ì°¨ê° (á»¨ng lÆ°Æ¡ng)</span>
                <span class="info-value" style="color: #ff9800; font-weight: bold;" id="advancePaymentValue">-</span>
            </div>
            <div class="info-row" style="margin-top: 10px; padding-top: 15px;">
                <span class="info-label" style="font-weight: bold;">ì´ ê³µì œì•¡</span>
                <span class="info-value" style="color: #e53935;" id="deductTotal">-</span>
            </div>
        </div>

        <!-- ì‹¤ìˆ˜ë ¹ì•¡ -->
        <div class="total-section">
            <div class="net-salary-label">ğŸ’° ì‹¤ìˆ˜ë ¹ì•¡</div>
            <div class="net-salary-amount" id="netSalary">0 Ä‘</div>
            <div class="net-salary-text" id="netSalaryText">-</div>
        </div>

        <!-- í‘¸í„° -->
        <div class="footer">
            <p>ë³¸ ê¸‰ì—¬ëª…ì„¸ì„œëŠ” ì „ìë¬¸ì„œë¡œ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <p id="printDate">ë°œí–‰ì¼: -</p>
        </div>
    </div>

    <!-- ì €ì¥ ë²„íŠ¼ -->
    <div class="button-container">
        <button class="action-button btn-html" onclick="saveAsHTML()">ğŸ“„ HTML ì €ì¥</button>
        <button class="action-button" onclick="downloadPDF()">ğŸ’¾ PDF ì €ì¥</button>
    </div>

    <script>
        // ìˆ«ì í¬ë§·íŒ…
        function formatNumber(num) {
            return new Intl.NumberFormat('vi-VN').format(Math.round(num));
        }

        // URLì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function loadPayslipData() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('data');

            console.log('===== ğŸ“± ê¸‰ì—¬ëª…ì„¸ì„œ í˜ì´ì§€ ë¡œë“œ =====');
            console.log('URLì—ì„œ data íŒŒë¼ë¯¸í„° í™•ì¸...');

            if (!data) {
                console.error('âŒ ê¸‰ì—¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
                alert('ê¸‰ì—¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }

            console.log('âœ… data íŒŒë¼ë¯¸í„° ì¡´ì¬ (ê¸¸ì´:', data.length, ')');

            try {
                const payslipData = JSON.parse(decodeURIComponent(data));
                console.log('âœ… JSON íŒŒì‹± ì„±ê³µ');
                displayPayslip(payslipData);
            } catch (e) {
                console.error('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
                alert('ê¸‰ì—¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
            }
        }

        // ê¸‰ì—¬ëª…ì„¸ì„œ í‘œì‹œ
        function displayPayslip(data) {
            // ë°ì´í„° ì €ì¥ (PDF ìƒì„± ì‹œ ì‚¬ìš©)
            currentPayslipData = data;

            // PDF íŒŒì¼ëª… ì„¤ì • (ë¸Œë¼ìš°ì €ê°€ ì´ ì œëª©ì„ ê¸°ë³¸ íŒŒì¼ëª…ìœ¼ë¡œ ì‚¬ìš©)
            document.title = `${data.employeeName}_${data.year}ë…„${data.month}ì›”_ê¸‰ì—¬ëª…ì„¸ì„œ`;

            console.log('==========================================');
            console.log('===== ğŸ“± ëª¨ë°”ì¼ ê¸‰ì—¬ëª…ì„¸ì„œ ë°ì´í„° ìˆ˜ì‹  =====');
            console.log('==========================================');
            console.log('ğŸ“¦ ë°›ì€ ì „ì²´ ë°ì´í„°:', data);
            console.log('ğŸ¢ íšŒì‚¬ëª…:', data.companyName);
            console.log('ğŸ–¼ï¸ íšŒì‚¬ ë¡œê³ :', data.companyLogo);
            console.log('ğŸ‘¤ ì§ì›ëª…:', data.employeeName);
            console.log('ğŸ“… ì—°ë„:', data.year);
            console.log('ğŸ“… ì›”:', data.month);
            console.log('ğŸ’° ê¸°ë³¸ê¸‰:', data.basicSalary);
            console.log('ğŸ’ íŠ¹ìˆ˜ìˆ˜ë‹¹:', data.specialAllowance);
            console.log('ğŸ’° ì„ ê¸ˆ:', data.advancePayment);
            console.log('==========================================');

            // íšŒì‚¬ ì •ë³´
            const companyNameElement = document.getElementById('companyName');
            const companyLogoElement = document.getElementById('companyLogo');

            console.log('ğŸ¯ íšŒì‚¬ëª… í‘œì‹œ ì‹œì‘...');
            console.log('   - Element:', companyNameElement);
            console.log('   - í‘œì‹œí•  ê°’:', data.companyName || 'íšŒì‚¬ëª…');
            companyNameElement.textContent = data.companyName || 'íšŒì‚¬ëª…';
            console.log('âœ… íšŒì‚¬ëª… í‘œì‹œ ì™„ë£Œ:', companyNameElement.textContent);

            console.log('ğŸ¯ ë¡œê³  í‘œì‹œ ì‹œì‘...');
            console.log('   - Element:', companyLogoElement);
            if (data.companyLogo) {
                console.log('   - ë¡œê³  URL ìˆìŒ:', data.companyLogo);
                companyLogoElement.innerHTML = `<img src="${data.companyLogo}" alt="ë¡œê³ ">`;
                console.log('âœ… ë¡œê³  ì´ë¯¸ì§€ ì„¤ì • ì™„ë£Œ');
            } else {
                console.log('   - ë¡œê³  URL ì—†ìŒ - ê¸°ë³¸ ì•„ì´ì½˜ ì‚¬ìš©');
                companyLogoElement.innerHTML = 'ğŸ¢';
                console.log('âœ… ê¸°ë³¸ ì•„ì´ì½˜ ì„¤ì • ì™„ë£Œ');
            }

            // ê¸°ê°„
            document.getElementById('period').textContent = `${data.year}ë…„ ${data.month}ì›”`;

            // ì§ì› ì •ë³´
            document.getElementById('empName').textContent = data.employeeName;
            document.getElementById('empBasicSalary').textContent = formatNumber(data.basicSalary) + ' Ä‘';
            document.getElementById('empDependents').textContent = data.dependents + 'ëª…';

            // ê·¼ë¬´ í†µê³„
            document.getElementById('statTotalDays').textContent = data.totalDays + 'ì¼';
            document.getElementById('statWorkDays').textContent = data.workDays + 'ì¼';
            document.getElementById('statNormalHours').textContent = data.normalHours + 'h';
            document.getElementById('statOvertime').textContent = data.overtimeHours + 'h';
            document.getElementById('statNight').textContent = data.nightHours + 'h';
            document.getElementById('statSunday').textContent = data.sundayHours + 'h';

            // ê¸‰ì—¬ ìƒì„¸
            document.getElementById('payNormal').textContent = formatNumber(data.normalPay) + ' Ä‘';
            document.getElementById('payOvertime').textContent = formatNumber(data.overtimePay) + ' Ä‘';
            document.getElementById('payNight').textContent = formatNumber(data.nightPay) + ' Ä‘';
            document.getElementById('paySunday').textContent = formatNumber(data.sundayPay) + ' Ä‘';

            // ì´ ê¸‰ì—¬ ê¸°ë³¸ì•¡ (ì •ê·œ + ì•¼ê·¼ + ì•¼ê°„ + ì¼ìš”ì¼)
            const totalBasicPay = data.normalPay + data.overtimePay + data.nightPay + data.sundayPay;
            document.getElementById('totalBasicPay').textContent = formatNumber(totalBasicPay) + ' Ä‘';

            // ìˆ˜ë‹¹ - ì‹ëŒ€
            document.getElementById('totalMealCount').textContent = data.totalMealCount;
            document.getElementById('allowanceMeal').textContent = formatNumber(data.mealAllowance) + ' Ä‘';

            // ì‹ëŒ€ ì„¸ë¶€ (0ì‹ì¸ í•­ëª© ìˆ¨ê¹€)
            if (data.weekdayLunchCount > 0) {
                document.getElementById('mealWeekdayLunch').textContent =
                    `${data.weekdayLunchCount}ì‹ Ã— ${formatNumber(data.lunchMeal)}Ä‘ = ${formatNumber(data.weekdayLunchCount * data.lunchMeal)}Ä‘`;
            } else {
                document.getElementById('mealWeekdayLunchRow').style.display = 'none';
            }

            if (data.weekdayDinnerCount > 0) {
                document.getElementById('mealWeekdayDinner').textContent =
                    `${data.weekdayDinnerCount}ì‹ Ã— ${formatNumber(data.dinnerMeal)}Ä‘ = ${formatNumber(data.weekdayDinnerCount * data.dinnerMeal)}Ä‘`;
            } else {
                document.getElementById('mealWeekdayDinnerRow').style.display = 'none';
            }

            if (data.sundayLunchCount > 0) {
                document.getElementById('mealSundayLunch').textContent =
                    `${data.sundayLunchCount}ì‹ Ã— ${formatNumber(data.lunchMeal)}Ä‘ = ${formatNumber(data.sundayLunchCount * data.lunchMeal)}Ä‘`;
            } else {
                document.getElementById('mealSundayLunchRow').style.display = 'none';
            }

            if (data.sundayDinnerCount > 0) {
                document.getElementById('mealSundayDinner').textContent =
                    `${data.sundayDinnerCount}ì‹ Ã— ${formatNumber(data.dinnerMeal)}Ä‘ = ${formatNumber(data.sundayDinnerCount * data.dinnerMeal)}Ä‘`;
            } else {
                document.getElementById('mealSundayDinnerRow').style.display = 'none';
            }

            if (data.annualLeaveLunchCount > 0) {
                document.getElementById('mealAnnualLeaveLunch').textContent =
                    `${data.annualLeaveLunchCount}ì‹ Ã— ${formatNumber(data.lunchMeal)}Ä‘ = ${formatNumber(data.annualLeaveLunchCount * data.lunchMeal)}Ä‘`;
            } else {
                document.getElementById('mealAnnualLeaveLunchRow').style.display = 'none';
            }

            if (data.excusedAbsentLunchCount > 0) {
                document.getElementById('mealExcusedAbsentLunch').textContent =
                    `${data.excusedAbsentLunchCount}ì‹ Ã— ${formatNumber(data.lunchMeal)}Ä‘ = ${formatNumber(data.excusedAbsentLunchCount * data.lunchMeal)}Ä‘`;
            } else {
                document.getElementById('mealExcusedAbsentLunchRow').style.display = 'none';
            }

            // ë™ì  ìˆ˜ë‹¹ ë Œë”ë§
            const dynamicAllowancesContainer = document.getElementById('dynamicAllowancesContainer');
            dynamicAllowancesContainer.innerHTML = ''; // ì´ˆê¸°í™”

            if (data.allowances && data.allowances.length > 0) {
                data.allowances.forEach(allowance => {
                    const row = document.createElement('div');
                    row.className = 'info-row';
                    row.innerHTML = `
                        <span class="info-label">${allowance.name}</span>
                        <span class="info-value">${formatNumber(allowance.amount)} Ä‘</span>
                    `;
                    dynamicAllowancesContainer.appendChild(row);
                });
            } else {
                // ìˆ˜ë‹¹ì´ ì—†ëŠ” ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€ (ì„ íƒì‚¬í•­)
                dynamicAllowancesContainer.innerHTML = `
                    <div class="info-row" style="color: #888; font-style: italic;">
                        <span class="info-label">ì„¤ì •ëœ ìˆ˜ë‹¹ì´ ì—†ìŠµë‹ˆë‹¤</span>
                        <span class="info-value">0 Ä‘</span>
                    </div>
                `;
            }

            // íŠ¹ìˆ˜ìˆ˜ë‹¹ í‘œì‹œ
            if (data.specialAllowance && data.specialAllowance > 0) {
                document.getElementById('specialAllowanceRow').style.display = 'flex';
                document.getElementById('specialAllowanceValue').textContent = formatNumber(data.specialAllowance) + ' Ä‘';
            } else {
                document.getElementById('specialAllowanceRow').style.display = 'none';
            }

            // ì´ ìˆ˜ë‹¹ ê³„ì‚° (ì‹ëŒ€ + ë™ì  ìˆ˜ë‹¹ + íŠ¹ìˆ˜ìˆ˜ë‹¹)
            let totalDynamicAllowances = 0;
            if (data.allowances && data.allowances.length > 0) {
                totalDynamicAllowances = data.allowances.reduce((sum, allowance) => sum + allowance.amount, 0);
            }
            const totalAllowancesAmount = data.mealAllowance + totalDynamicAllowances + (data.specialAllowance || 0);
            document.getElementById('totalAllowances').textContent = formatNumber(totalAllowancesAmount) + ' Ä‘';

            // ê³µì œ
            document.getElementById('deductSocial').textContent = formatNumber(data.socialIns) + ' Ä‘';
            document.getElementById('deductHealth').textContent = formatNumber(data.healthIns) + ' Ä‘';
            document.getElementById('deductUnemploy').textContent = formatNumber(data.unemployIns) + ' Ä‘';
            document.getElementById('deductTax').textContent = formatNumber(data.incomeTax) + ' Ä‘';

            // ì„ ê¸ˆ í‘œì‹œ
            if (data.advancePayment && data.advancePayment > 0) {
                document.getElementById('advancePaymentRow').style.display = 'flex';
                document.getElementById('advancePaymentValue').textContent = formatNumber(data.advancePayment) + ' Ä‘';
            } else {
                document.getElementById('advancePaymentRow').style.display = 'none';
            }

            // ì´ ê³µì œì•¡ (ë³´í—˜ë£Œ + ì†Œë“ì„¸ + ì„ ê¸ˆ)
            const totalDeductionAmount = data.totalDeduction + data.incomeTax + (data.advancePayment || 0);
            document.getElementById('deductTotal').textContent = formatNumber(totalDeductionAmount) + ' Ä‘';

            // ì‹¤ìˆ˜ë ¹ì•¡
            document.getElementById('netSalary').textContent = formatNumber(data.netSalary) + ' Ä‘';
            document.getElementById('netSalaryText').textContent = numberToVietnamese(data.netSalary) + ' Ä‘á»“ng';

            // ë°œí–‰ì¼
            const today = new Date();
            document.getElementById('printDate').textContent = `ë°œí–‰ì¼: ${today.getFullYear()}ë…„ ${today.getMonth()+1}ì›” ${today.getDate()}ì¼`;
        }

        // ìˆ«ìë¥¼ ë² íŠ¸ë‚¨ì–´ë¡œ ë³€í™˜ (ê°„ë‹¨ ë²„ì „)
        function numberToVietnamese(num) {
            const roundedNum = Math.round(num);

            if (roundedNum >= 1000000) {
                const millions = Math.floor(roundedNum / 1000000);
                const thousands = Math.floor((roundedNum % 1000000) / 1000);
                if (thousands === 0) {
                    return `${millions} triá»‡u`;
                }
                return `${millions} triá»‡u ${thousands} nghÃ¬n`;
            } else if (roundedNum >= 1000) {
                const thousands = Math.floor(roundedNum / 1000);
                return `${thousands} nghÃ¬n`;
            }
            return `${roundedNum}`;
        }

        // PDF ë‹¤ìš´ë¡œë“œ
        let currentPayslipData = null;

        function downloadPDF() {
            if (!currentPayslipData) {
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
                return;
            }

            // ë¸Œë¼ìš°ì € ì¸ì‡„ ê¸°ëŠ¥ ì‚¬ìš©
            // ëª¨ë°”ì¼: ì¸ì‡„ ëŒ€í™”ìƒìì—ì„œ "PDFë¡œ ì €ì¥" ì„ íƒ
            // íŒŒì¼ëª…ì€ ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ìƒì„±
            window.print();
        }

        // HTML íŒŒì¼ë¡œ ì €ì¥
        function saveAsHTML() {
            if (!currentPayslipData) {
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
                return;
            }

            // íŒŒì¼ëª… ìƒì„±
            const fileName = `${currentPayslipData.employeeName}_${currentPayslipData.year}ë…„${currentPayslipData.month}ì›”_ê¸‰ì—¬ëª…ì„¸ì„œ.html`;

            // í˜„ì¬ HTML ë³µì œ
            const clonedDoc = document.documentElement.cloneNode(true);

            // ë³µì œëœ ë¬¸ì„œì—ì„œ ë²„íŠ¼ ì œê±°
            const buttonContainer = clonedDoc.querySelector('.button-container');
            if (buttonContainer) {
                buttonContainer.remove();
            }

            // ì™„ì „í•œ HTML ë¬¸ìì—´ ìƒì„±
            const htmlContent = '<!DOCTYPE html>\n' + clonedDoc.outerHTML;

            // Blob ìƒì„±
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });

            // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;

            // í´ë¦­í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // URL í•´ì œ
            URL.revokeObjectURL(link.href);

            console.log('âœ… HTML íŒŒì¼ ì €ì¥ ì™„ë£Œ:', fileName);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.onload = loadPayslipData;
    </script>
</body>
</html>
