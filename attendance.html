<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶œí‡´ê·¼ ê´€ë¦¬ - Vietnam Payroll System</title>

    <!-- SheetJS for Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            color: #333;
        }

        /* í—¤ë” */
        .header {
            background: #2c3e50;
            color: #fff;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.3rem;
        }

        .header-nav {
            display: flex;
            gap: 10px;
        }

        .header-nav a {
            color: #fff;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }

        .header-nav a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* íˆ´ë°” */
        .toolbar {
            background: #fff;
            padding: 15px 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }

        .toolbar select, .toolbar input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: #fff;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: #fff;
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-warning {
            background: #f39c12;
            color: #fff;
        }

        .btn-secondary {
            background: #95a5a6;
            color: #fff;
        }

        .btn-danger {
            background: #e74c3c;
            color: #fff;
        }
        .btn-danger:hover {
            background: #c0392b;
        }

        /* ì €ì¥ í•„ìš” í‘œì‹œ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* ì—‘ì…€ ìŠ¤íƒ€ì¼ í…Œì´ë¸” */
        .table-container {
            overflow-x: auto;
            overflow-y: auto;
            max-height: calc(100vh - 200px); /* í™”ë©´ ë†’ì´ - í—¤ë”/íˆ´ë°” */
            padding: 20px;
            padding-top: 0;
        }

        .excel-table {
            border-collapse: collapse;
            table-layout: fixed;
            font-size: 0.8rem;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .excel-table th, .excel-table td {
            border: 1px solid #ccc;
            padding: 4px 2px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
        }

        .excel-table th {
            background: #34495e;
            color: #fff;
            font-weight: 600;
        }

        /* ê³ ì • ì—´ (STT, CODE, ì´ë¦„, ìœ í˜•) */
        .excel-table .col-stt {
            width: 35px;
            min-width: 35px;
            background: #f8f9fa;
        }

        .excel-table .col-code {
            width: 70px;
            min-width: 70px;
            background: #e8f4fc;
            font-weight: bold;
            color: #2980b9;
        }

        .excel-table .col-name {
            width: 130px;
            min-width: 130px;
            text-align: left;
            background: #f8f9fa;
            padding-left: 5px;
        }

        .excel-table .col-type {
            width: 75px;
            min-width: 75px;
            font-weight: bold;
            font-size: 0.75rem;
        }

        .type-normal {
            background: #d5f5e3 !important;
            color: #27ae60;
        }

        .type-overtime {
            background: #fdebd0 !important;
            color: #e67e22;
        }

        .type-night {
            background: #e8daef !important;
            color: #8e44ad;
        }

        .type-holiday {
            background: #fadbd8 !important;
            color: #e74c3c;
        }

        /* ë‚ ì§œ ì—´ */
        .excel-table .col-day {
            width: 42px;
            min-width: 42px;
            max-width: 42px;
            padding: 4px 2px;
        }

        .excel-table .col-day.sunday {
            background: #ffebee !important;
        }

        .excel-table th.col-day {
            font-size: 0.9rem;
            padding: 5px 2px;
        }

        /* ì¼ìš”ì¼ í—¤ë” - ë¹¨ê°„ ê¸€ì”¨ */
        .excel-table th.col-day.sunday {
            background: #c62828 !important;
            color: #fff;
        }

        /* í•©ê³„ ì—´ */
        .excel-table .col-total {
            width: 50px;
            min-width: 50px;
            background: #fff3cd;
            font-weight: bold;
            font-size: 0.95rem;
        }

        /* í•©ê³„ í—¤ë” - ì–´ë‘ìš´ ë°°ê²½ ìœ ì§€ */
        .excel-table th.col-total {
            background: #e65100 !important;
            color: #fff;
        }

        /* ì—°ì°¨ ì‚¬ìš© ì»¬ëŸ¼ */
        .excel-table .col-leave-used {
            width: 50px;
            min-width: 50px;
            background: #e8f5e9;
            font-weight: bold;
            font-size: 0.95rem;
            color: #2e7d32;
            text-align: center;
            vertical-align: middle;
        }

        .excel-table th.col-leave-used {
            background: #388e3c !important;
            color: #fff;
        }

        /* ì—°ì°¨ ì”ì—¬ ì»¬ëŸ¼ */
        .excel-table .col-leave-remain {
            width: 50px;
            min-width: 50px;
            background: #fff3e0;
            font-weight: bold;
            font-size: 0.95rem;
            color: #e65100;
            text-align: center;
            vertical-align: middle;
        }

        .excel-table th.col-leave-remain {
            background: #f57c00 !important;
            color: #fff;
        }

        /* ì…ë ¥ í•„ë“œ */
        .excel-table input {
            width: 100%;
            max-width: 38px;
            border: none;
            background: transparent;
            text-align: center;
            font-size: 0.9rem;
            padding: 2px;
        }

        .excel-table input:focus {
            outline: 2px solid #3498db;
            background: #fff;
        }

        .excel-table input::-webkit-inner-spin-button,
        .excel-table input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .excel-table input[type=number] {
            -moz-appearance: textfield;
        }

        /* ì§ì› ê·¸ë£¹ */
        .employee-group {
            border-top: 2px solid #34495e;
        }

        .employee-group:first-child {
            border-top: none;
        }

        /* í—¤ë” ê³ ì • (ìŠ¤í¬ë¡¤í•´ë„ í•­ìƒ ë³´ì„) */
        .excel-table thead th {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #34495e;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .excel-table thead {
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .excel-table th.col-day {
            height: 40px;
            vertical-align: middle;
        }

        /* ë²”ë¡€ */
        .legend {
            display: flex;
            gap: 15px;
            padding: 10px 30px;
            background: #fff;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
            align-items: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        /* ìš”ì•½ */
        .summary-bar {
            background: #2c3e50;
            color: #fff;
            padding: 10px 30px;
            display: flex;
            gap: 30px;
            font-size: 0.9rem;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-value {
            font-weight: bold;
            color: #3498db;
        }

        /* ë¹ ë¥¸ ì…ë ¥ ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #fff;
            border-radius: 10px;
            padding: 25px;
            min-width: 350px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-header h3 {
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .quick-btns {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .quick-btn {
            padding: 5px 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: #f8f9fa;
            cursor: pointer;
        }

        .quick-btn:hover {
            background: #e9ecef;
        }

        .no-data {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        /* ë°˜ì‘í˜• - ëŒ€í˜• ëª¨ë‹ˆí„° (1920px ì´ìƒ) */
        @media (min-width: 1920px) {
            .excel-table .col-day {
                width: 52px;
                min-width: 52px;
                max-width: 52px;
            }
            .excel-table th.col-day {
                font-size: 1rem;
            }
            .excel-table input {
                max-width: 48px;
                font-size: 1rem;
            }
            .excel-table .col-total,
            .excel-table .col-leave-used,
            .excel-table .col-leave-remain {
                width: 60px;
                min-width: 60px;
                font-size: 1rem;
            }
        }

        /* ë°˜ì‘í˜• - ì¤‘í˜• ëª¨ë‹ˆí„° (1440px ~ 1919px) */
        @media (min-width: 1440px) and (max-width: 1919px) {
            .excel-table .col-day {
                width: 46px;
                min-width: 46px;
                max-width: 46px;
            }
            .excel-table th.col-day {
                font-size: 0.95rem;
            }
            .excel-table input {
                max-width: 42px;
                font-size: 0.95rem;
            }
            .excel-table .col-total,
            .excel-table .col-leave-used,
            .excel-table .col-leave-remain {
                width: 55px;
                min-width: 55px;
            }
        }

        /* ë°˜ì‘í˜• - ë…¸íŠ¸ë¶ (1024px ~ 1439px) */
        @media (min-width: 1024px) and (max-width: 1439px) {
            .excel-table .col-day {
                width: 38px;
                min-width: 38px;
                max-width: 38px;
            }
            .excel-table th.col-day {
                font-size: 0.85rem;
            }
            .excel-table input {
                max-width: 34px;
                font-size: 0.85rem;
            }
            .excel-table .col-total,
            .excel-table .col-leave-used,
            .excel-table .col-leave-remain {
                width: 45px;
                min-width: 45px;
                font-size: 0.85rem;
            }
        }

        /* ë°˜ì‘í˜• - ì‘ì€ ë…¸íŠ¸ë¶/íƒœë¸”ë¦¿ (768px ~ 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .excel-table .col-day {
                width: 32px;
                min-width: 32px;
                max-width: 32px;
            }
            .excel-table th.col-day {
                font-size: 0.75rem;
                padding: 3px 1px;
            }
            .excel-table input {
                max-width: 28px;
                font-size: 0.75rem;
            }
            .excel-table .col-total,
            .excel-table .col-leave-used,
            .excel-table .col-leave-remain {
                width: 40px;
                min-width: 40px;
                font-size: 0.8rem;
            }
        }

        /* ë°˜ì‘í˜• - ëª¨ë°”ì¼ */
        @media (max-width: 767px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            .excel-table .col-day {
                width: 28px;
                min-width: 28px;
                max-width: 28px;
            }
            .excel-table th.col-day {
                font-size: 0.7rem;
                padding: 2px 1px;
            }
            .excel-table input {
                max-width: 24px;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <h1>ğŸ“… BANG CHAM CONG (ì¶œí‡´ê·¼ ê´€ë¦¬)</h1>
        <nav class="header-nav">
            <a href="index.html">ğŸ“Š ê¸‰ì—¬ëŒ€ì¥</a>
            <a href="salary-input.html">ğŸ’° ê¸‰ì—¬ê³„ì‚°</a>
            <a href="settings.html">âš™ï¸ ì„¤ì •</a>
        </nav>
    </header>

    <!-- íˆ´ë°” -->
    <div class="toolbar">
        <div>
            <label>ë…„ë„:</label>
            <select id="selectYear"></select>
        </div>
        <div>
            <label>ì›”:</label>
            <select id="selectMonth"></select>
        </div>
        <button class="btn btn-primary" onclick="loadEmployeeFromMoney()">ğŸ”„ ì§ì› ë™ê¸°í™”</button>
        <button class="btn btn-warning" onclick="openQuickFill()">âš¡ ë¹ ë¥¸ ì…ë ¥</button>
        <span style="margin: 0 10px; color: #2c3e50; font-weight: bold; font-size: 1.2em;">â”‚</span>
        <button class="btn btn-info" onclick="pullFromSalaryCalc()" style="background: #00bcd4;">ğŸ“¥ ê¸‰ì—¬ê³„ì‚°ê¸°ì—ì„œ ë“¤ê³ ì˜¤ê¸°</button>
        <button class="btn btn-success" onclick="pushToSalaryCalc()">ğŸ“¤ ê¸‰ì—¬ê³„ì‚°ê¸°ë¡œ ë³´ë‚´ê¸°</button>
        <span style="margin: 0 10px; color: #2c3e50; font-weight: bold; font-size: 1.2em;">â”‚</span>
        <button class="btn btn-primary" onclick="exportToExcel()">ğŸ“Š ì—‘ì…€ ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn btn-secondary" onclick="importFromExcel()">ğŸ“‚ ì—‘ì…€ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <span style="margin: 0 10px; color: #2c3e50; font-weight: bold; font-size: 1.2em;">â”‚</span>
        <button class="btn btn-danger" onclick="resetAttendanceData()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
    </div>

    <!-- ë²”ë¡€ -->
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #d5f5e3;"></div>
            <span>Giá» ChÃ­nh (ì •ìƒ)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #fdebd0;"></div>
            <span>TÄƒng Ca (ì•¼ê·¼)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e8daef;"></div>
            <span>Ca ÄÃªm (ì•¼ê°„)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #fadbd8;"></div>
            <span>Chá»§ Nháº­t (íœ´ì¼)</span>
        </div>
        <span style="margin: 0 10px; color: #ccc;">|</span>
        <div class="legend-item">
            <div class="legend-color" style="background: #4caf50;"></div>
            <span>ğŸ–ï¸ ì—°ì°¨</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #9c27b0;"></div>
            <span>ğŸ–¤ íŠ¹ë³„íœ´ê°€</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #ff9800;"></div>
            <span>ğŸ¥ ë³‘ê°€</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #607d8b;"></div>
            <span>ğŸ“ ì‚¬ìœ ê²°ê·¼</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #000000;"></div>
            <span>âŒ ë¬´ë‹¨ê²°ê·¼</span>
        </div>
    </div>

    <!-- ì—‘ì…€ ìŠ¤íƒ€ì¼ í…Œì´ë¸” -->
    <div class="table-container">
        <table class="excel-table" id="attendanceTable">
            <thead id="tableHead">
                <!-- í—¤ë”ê°€ ì—¬ê¸°ì— ìƒì„±ë¨ -->
            </thead>
            <tbody id="tableBody">
                <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ìƒì„±ë¨ -->
            </tbody>
        </table>
        <div class="no-data" id="noDataMsg">
            <h3>ì§ì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p style="margin-top: 10px;">ğŸ”„ ì§ì› ë™ê¸°í™” ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜<br>ì„¤ì • í˜ì´ì§€ì—ì„œ ì§ì›ì„ ë“±ë¡í•˜ì„¸ìš”.</p>
        </div>
    </div>

    <!-- ë¹ ë¥¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div class="modal" id="quickFillModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âš¡ ë¹ ë¥¸ ì…ë ¥</h3>
                <button class="modal-close" onclick="closeQuickFill()">&times;</button>
            </div>
            <div class="form-group">
                <label>ëŒ€ìƒ ì§ì›:</label>
                <select id="quickEmployee" style="width: 100%; padding: 10px;">
                    <option value="all">ì „ì²´ ì§ì›</option>
                </select>
            </div>
            <div class="form-group">
                <label>ì ìš© ë‚ ì§œ:</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="number" id="quickDayStart" min="1" max="31" value="1" style="width: 60px;">
                    <span>~</span>
                    <input type="number" id="quickDayEnd" min="1" max="31" value="31" style="width: 60px;">
                    <span>ì¼</span>
                </div>
                <div class="quick-btns">
                    <button class="quick-btn" onclick="setQuickDays(1, 31)">ì „ì²´</button>
                    <button class="quick-btn" onclick="setQuickDays(1, 15)">1~15</button>
                    <button class="quick-btn" onclick="setQuickDays(16, 31)">16~31</button>
                    <button class="quick-btn" onclick="setQuickWeekdays()">í‰ì¼ë§Œ</button>
                </div>
            </div>
            <div class="form-group">
                <label>ì •ìƒ ê·¼ë¬´ (ì‹œê°„):</label>
                <input type="number" id="quickNormal" min="0" max="24" value="8">
            </div>
            <div class="form-group">
                <label>ì•¼ê·¼ (ì‹œê°„):</label>
                <input type="number" id="quickOvertime" min="0" max="12" value="0">
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-primary" style="flex: 1;" onclick="applyQuickFill()">ì ìš©</button>
                <button class="btn btn-secondary" onclick="closeQuickFill()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì—‘ì…€ ë¶ˆëŸ¬ì˜¤ê¸°ìš© hidden input -->
    <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleExcelImport(event)">

    <script src="attendance.js"></script>
</body>
</html>
